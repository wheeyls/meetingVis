var times = {"chris":{"start":["2012-06-06T21:08:35.627Z","2012-06-06T21:08:54.903Z"],"end":["2012-06-06T21:08:41.463Z","2012-06-06T21:09:11.408Z"]},"steven":{"start":["2012-06-06T21:08:41.463Z"],"end":["2012-06-06T21:08:46.960Z"]},"mark":{"start":["2012-06-06T21:08:46.960Z","2012-06-06T21:09:11.408Z","2012-06-06T21:09:41.150Z","2012-06-06T21:10:36.916Z","2012-06-06T21:11:22.139Z","2012-06-06T21:12:05.970Z","2012-06-06T21:12:48.433Z","2012-06-06T21:12:58.633Z","2012-06-06T21:13:12.719Z","2012-06-06T21:13:57.300Z","2012-06-06T21:14:15.750Z","2012-06-06T21:14:20.861Z","2012-06-06T21:14:47.509Z","2012-06-06T21:14:57.589Z","2012-06-06T21:15:06.197Z","2012-06-06T21:15:42.103Z","2012-06-06T21:16:10.197Z","2012-06-06T21:16:20.372Z","2012-06-06T21:16:40.103Z","2012-06-06T21:17:03.216Z","2012-06-06T21:17:10.513Z","2012-06-06T21:17:58.288Z","2012-06-06T21:18:29.520Z","2012-06-06T21:18:42.832Z","2012-06-06T21:18:59.409Z","2012-06-06T21:19:06.367Z","2012-06-06T21:21:14.635Z","2012-06-06T21:21:32.075Z","2012-06-06T21:21:35.242Z","2012-06-06T21:22:05.169Z","2012-06-06T21:22:11.850Z","2012-06-06T21:22:40.551Z","2012-06-06T21:22:51.936Z","2012-06-06T21:23:50.855Z","2012-06-06T21:24:30.503Z","2012-06-06T21:24:46.596Z","2012-06-06T21:25:15.452Z","2012-06-06T21:25:27.413Z","2012-06-06T21:25:53.867Z","2012-06-06T21:26:12.379Z","2012-06-06T21:26:48.649Z"],"end":["2012-06-06T21:08:54.903Z","2012-06-06T21:09:33.074Z","2012-06-06T21:10:08.117Z","2012-06-06T21:11:06.019Z","2012-06-06T21:11:27.450Z","2012-06-06T21:12:14.345Z","2012-06-06T21:12:53.912Z","2012-06-06T21:13:08.982Z","2012-06-06T21:13:19.681Z","2012-06-06T21:13:59.354Z","2012-06-06T21:14:18.286Z","2012-06-06T21:14:28.942Z","2012-06-06T21:14:48.589Z","2012-06-06T21:15:00.813Z","2012-06-06T21:15:18.205Z","2012-06-06T21:15:46.963Z","2012-06-06T21:16:14.700Z","2012-06-06T21:16:28.964Z","2012-06-06T21:16:53.042Z","2012-06-06T21:17:04.138Z","2012-06-06T21:17:33.967Z","2012-06-06T21:18:09.328Z","2012-06-06T21:18:40.591Z","2012-06-06T21:18:55.407Z","2012-06-06T21:19:03.452Z","2012-06-06T21:21:00.713Z","2012-06-06T21:21:17.787Z","2012-06-06T21:21:33.041Z","2012-06-06T21:22:02.247Z","2012-06-06T21:22:06.473Z","2012-06-06T21:22:37.127Z","2012-06-06T21:22:50.536Z","2012-06-06T21:23:36.927Z","2012-06-06T21:24:23.652Z","2012-06-06T21:24:31.999Z","2012-06-06T21:25:13.573Z","2012-06-06T21:25:26.453Z","2012-06-06T21:25:49.123Z","2012-06-06T21:26:09.334Z","2012-06-06T21:26:42.370Z","2012-06-06T21:26:57.055Z"]},"jeff":{"start":["2012-06-06T21:09:33.074Z","2012-06-06T21:10:08.117Z"],"end":["2012-06-06T21:09:41.150Z","2012-06-06T21:10:13.293Z"]},"shane":{"start":["2012-06-06T21:10:13.293Z"],"end":["2012-06-06T21:10:36.916Z"]},"mike":{"start":["2012-06-06T21:11:06.019Z","2012-06-06T21:15:46.963Z","2012-06-06T21:16:01.202Z"],"end":["2012-06-06T21:11:18.059Z","2012-06-06T21:15:49.187Z","2012-06-06T21:16:10.197Z"]},"van":{"start":["2012-06-06T21:11:27.450Z","2012-06-06T21:12:14.345Z","2012-06-06T21:12:31.986Z","2012-06-06T21:13:08.982Z","2012-06-06T21:13:19.681Z","2012-06-06T21:13:59.354Z"],"end":["2012-06-06T21:12:05.970Z","2012-06-06T21:12:27.297Z","2012-06-06T21:12:48.433Z","2012-06-06T21:13:12.719Z","2012-06-06T21:13:57.300Z","2012-06-06T21:14:13.221Z"]},"inder":{"start":["2012-06-06T21:14:28.942Z","2012-06-06T21:14:48.589Z","2012-06-06T21:15:00.813Z","2012-06-06T21:23:41.110Z","2012-06-06T21:24:23.652Z","2012-06-06T21:24:31.999Z","2012-06-06T21:25:13.573Z","2012-06-06T21:25:26.453Z","2012-06-06T21:25:49.123Z"],"end":["2012-06-06T21:14:47.509Z","2012-06-06T21:14:57.589Z","2012-06-06T21:15:06.197Z","2012-06-06T21:23:50.855Z","2012-06-06T21:24:30.503Z","2012-06-06T21:24:46.596Z","2012-06-06T21:25:15.452Z","2012-06-06T21:25:27.413Z","2012-06-06T21:25:51.298Z"]},"bert":{"start":["2012-06-06T21:15:18.205Z","2012-06-06T21:15:49.187Z","2012-06-06T21:16:14.700Z"],"end":["2012-06-06T21:15:42.103Z","2012-06-06T21:16:01.202Z","2012-06-06T21:16:20.372Z"]},"jia":{"start":["2012-06-06T21:16:28.964Z","2012-06-06T21:16:53.042Z","2012-06-06T21:17:04.138Z","2012-06-06T21:17:33.967Z","2012-06-06T21:18:09.328Z","2012-06-06T21:18:40.591Z","2012-06-06T21:18:55.407Z","2012-06-06T21:22:02.247Z","2012-06-06T21:22:06.473Z","2012-06-06T21:22:37.127Z"],"end":["2012-06-06T21:16:40.103Z","2012-06-06T21:17:03.216Z","2012-06-06T21:17:10.513Z","2012-06-06T21:17:58.288Z","2012-06-06T21:18:29.520Z","2012-06-06T21:18:42.832Z","2012-06-06T21:18:59.409Z","2012-06-06T21:22:05.169Z","2012-06-06T21:22:11.850Z","2012-06-06T21:22:40.551Z"]},"simon":{"start":["2012-06-06T21:21:00.713Z","2012-06-06T21:21:17.787Z","2012-06-06T21:21:33.041Z"],"end":["2012-06-06T21:21:14.635Z","2012-06-06T21:21:32.075Z","2012-06-06T21:21:35.242Z"]}},
current;

var times = {"bartender":{"start":["2012-07-10T23:51:20.201Z"],"end":["2012-07-10T23:57:27.687Z"]},"customer-service":{"start":["2012-07-10T23:57:27.687Z"],"end":["2012-07-10T23:58:23.845Z"]},"qna":{"start":["2012-07-10T23:58:23.845Z","2012-07-11T00:34:43.573Z"],"end":["2012-07-11T00:01:31.108Z","2012-07-11T00:35:01.590Z"]},"documentation":{"start":["2012-07-11T00:01:31.108Z"],"end":["2012-07-11T00:11:23.942Z"]},"meeting people":{"start":["2012-07-11T00:11:23.942Z"],"end":["2012-07-11T00:22:24.597Z"]},"breakable-toy":{"start":["2012-07-11T00:22:24.597Z"],"end":["2012-07-11T00:26:33.940Z"]},"regex-assertions":{"start":["2012-07-11T00:26:33.940Z"],"end":["2012-07-11T00:34:43.573Z"]}};

var times = {"mike":{"start":["2012-07-12T19:47:40.917Z","2012-07-12T19:47:50.013Z","2012-07-12T19:50:21.433Z"],"end":["2012-07-12T19:47:45.973Z","2012-07-12T19:49:09.045Z","2012-07-12T19:50:25.058Z"]},"matt":{"start":["2012-07-12T19:47:45.973Z","2012-07-12T19:53:21.552Z","2012-07-12T19:54:21.722Z","2012-07-12T19:56:08.690Z","2012-07-12T19:56:20.972Z","2012-07-12T19:56:55.118Z","2012-07-12T19:58:47.228Z","2012-07-12T19:59:05.760Z","2012-07-12T19:59:16.690Z","2012-07-12T19:59:19.874Z","2012-07-12T19:59:56.496Z","2012-07-12T20:00:52.318Z"],"end":["2012-07-12T19:47:50.013Z","2012-07-12T19:53:27.481Z","2012-07-12T19:56:04.898Z","2012-07-12T19:56:19.493Z","2012-07-12T19:56:53.342Z","2012-07-12T19:58:45.604Z","2012-07-12T19:59:04.296Z","2012-07-12T19:59:13.450Z","2012-07-12T19:59:17.690Z","2012-07-12T19:59:25.826Z","2012-07-12T19:59:58.552Z","2012-07-12T20:00:57.885Z"]},"mark":{"start":["2012-07-12T19:49:09.045Z","2012-07-12T19:49:37.148Z","2012-07-12T19:50:08.306Z"],"end":["2012-07-12T19:49:35.372Z","2012-07-12T19:50:06.169Z","2012-07-12T19:50:21.433Z"]},"godard":{"start":["2012-07-12T19:49:35.372Z","2012-07-12T19:50:06.169Z","2012-07-12T19:51:26.906Z","2012-07-12T19:52:48.906Z","2012-07-12T19:53:01.943Z","2012-07-12T19:53:09.592Z","2012-07-12T19:53:32.969Z","2012-07-12T19:53:40.968Z","2012-07-12T19:53:50.432Z","2012-07-12T19:53:53.249Z","2012-07-12T19:54:04.001Z","2012-07-12T19:56:04.898Z","2012-07-12T19:56:19.493Z","2012-07-12T19:56:53.342Z","2012-07-12T19:58:45.604Z","2012-07-12T19:59:04.296Z","2012-07-12T19:59:13.450Z","2012-07-12T19:59:17.690Z","2012-07-12T19:59:25.826Z","2012-07-12T19:59:58.552Z","2012-07-12T20:00:57.885Z"],"end":["2012-07-12T19:49:37.148Z","2012-07-12T19:50:08.306Z","2012-07-12T19:51:28.730Z","2012-07-12T19:52:50.898Z","2012-07-12T19:53:02.928Z","2012-07-12T19:53:21.552Z","2012-07-12T19:53:36.049Z","2012-07-12T19:53:45.632Z","2012-07-12T19:53:51.481Z","2012-07-12T19:53:53.889Z","2012-07-12T19:54:06.248Z","2012-07-12T19:56:08.690Z","2012-07-12T19:56:20.972Z","2012-07-12T19:56:55.118Z","2012-07-12T19:58:47.228Z","2012-07-12T19:59:05.760Z","2012-07-12T19:59:16.690Z","2012-07-12T19:59:19.874Z","2012-07-12T19:59:56.496Z","2012-07-12T20:00:52.318Z","2012-07-12T20:01:00.684Z"]},"tim":{"start":["2012-07-12T19:50:25.058Z","2012-07-12T19:51:28.730Z","2012-07-12T19:52:50.898Z","2012-07-12T19:53:02.928Z","2012-07-12T19:54:00.497Z"],"end":["2012-07-12T19:51:26.906Z","2012-07-12T19:52:48.906Z","2012-07-12T19:53:01.943Z","2012-07-12T19:53:09.592Z","2012-07-12T19:54:04.001Z"]},"phone":{"start":["2012-07-12T19:54:13.469Z"],"end":["2012-07-12T19:54:21.722Z"]}};

var me = function dataCollect() {
  var current = null
    , me = {times: {}}
    ;

  me.startTimer = function (name) {
    me.times[name] = me.times[name] || {start: [], end: []};
    me.times[name].start.push(new Date());
    me.times[current] && (me.times[current].end.push(new Date()));
    current = name;
  }

  me.endTimer = function() {
    current && (me.times[current] = me.times[current] || {start: [], end: []});
    me.times[current].end.push(new Date());
    current = null;
  }

  return me;
}();

function stringsToDates(times) {
  for(var i in times) {
    times[i].start.forEach(function (val, ind) {
      times[i].start[ind] = new Date(val);
    });
    times[i].end.forEach(function (val, ind) {
      times[i].end[ind] = new Date(val);
    });
  }
}

function repeat(char, num) {
    var count = 0, str = "";
    while(count < num) {
        str += char;
        count++;
    }
    return str;
}

function earliest(times) {
    var answer;
    for(var i in times) {
        if(!answer || answer > times[i].start[0]) {
            answer = times[i].start[0];
        }
    }
    return answer;
}
function latest(times) {
    var answer;
    for(var i in times) {
        if(!answer || answer < times[i].end.slice(-1)[0]) {
            answer = times[i].end.slice(-1)[0];
        }
    }
    return answer;
}

function scaleTime(ms) {
  ms = ms/1000;

  return ms;
}

function createRowEl(width, name) {
  var el = document.createElement('div'),
      hd = document.createElement('div'),
      h = 40;

  hd.innerHTML = name;
  hd.setAttribute('class', 'hd');

  el.style.width = width + 'px';
  el.setAttribute('class', 'row');
  el.innerHTML = '&nbsp;';

  document.body.appendChild(hd);
  document.body.appendChild(el);
  return el;
}

function drawSlot(start, length, parentEl) {
  var el = document.createElement('div'),
      h = 20;
  el.style.width = length + 'px';
  el.style.position = 'absolute';
  el.style.left = (start) + 'px';
  el.setAttribute('class', 'slot');
  el.innerHTML = "&nbsp;";

  parentEl.appendChild(el);
}

function drawVLine(x) {
  var el = document.createElement('div');

  el.style.position = 'absolute';
  el.style.left = x+'px';
  el.style.height = '100%';
  el.innerHTML = '&nbsp;';
  el.setAttribute('class', 'v-line');

  document.body.appendChild(el);
}
function drawLegend(totalTime) {
  var numberLines = totalTime % 60,
      count = 0;

  while(count < numberLines) {
    drawVLine(8 + count * (totalTime / numberLines));
    console.log(count++);
  }
}

function drawName(name, start, parentEl) {
  var el = document.createElement('div'),
      h = 20;

  el.style.position = 'absolute';
  el.style.left = (start) + 'px';
  el.innerHTML = name;

  parentEl.appendChild(el);
}

function show(times) {
    stringsToDates(times);
    var begin = earliest(times);
    var done = latest(times);
    var totalTime = done-begin;
    var count = 0;

    drawLegend(scaleTime(totalTime));
    for(var i in times) {
        var myTime = 0,
            rowEl;
        count++;

        rowEl = createRowEl(scaleTime(totalTime), i);

        times[i].start.forEach(function (val, ind) {
            var fromStart = val - begin;
            var thisEnd = times[i].end[ind];
            var thisDuration = thisEnd - val;

            drawSlot(scaleTime(fromStart), scaleTime(thisDuration), rowEl);
        });
    }
}
show(times);
